<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nodal Zero Viewer</title>
  <meta name="description" content="An educational tool to visualize parallax and entrance pupil alignment in VR or browser." />
  <link rel="icon" href="data:," /> <!-- Prevents 404 favicon error -->
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }

      .ui-overlay {
     
        z-index: 999; /* VERY IMPORTANT: ensures it's above the canvas */
        width: 100%;
        height: 100%;
        pointer-events: none; /* Let VR interactions pass through unless overridden */
      }

      .ui-overlay * {
        pointer-events: auto; /* Allow user interaction inside overlay elements */
        font-family: sans-serif;
      }

      .ui-control {
        position: absolute;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.8);
        padding: 4px;
        border-radius: 4px;
      }
    </style>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script type="module" src="fov-module.js"></script>
    <script type="module" src="rotation-controller.js"></script>
    <script type="module" src="z-offset-controller.js"></script>
    <script type="module" src="camera-switcher.js"></script>
    <script type="module" src="send-to-home.js"></script>
    <script type="module" src="send-to-zero.js"></script>
    <script type="module" src="slider-readout.js"></script>
    <script type="module" src="main.js"></script>
  </head>
  <body>
    <!-- Fixed Header -->
<div id="headerBar"
     style="position: fixed; top: 0; left: 0; width: 100%; padding: 10px 20px;
            background: rgba(0, 0, 0, 0.7); color: white; font-family: sans-serif;
            font-size: 1.2em; z-index: 100;">
  Nodal Zero Viewer: Adjust Z Offset to pan without parallax.
</div>

    
    <!-- Splash Screen / Landing Panel -->
<section id="landing-info" style="font-family: sans-serif; max-width: 800px; margin: 2em auto; padding: 1.5em; background: #fefefe; border-radius: 10px; box-shadow: 0 2px 12px rgba(0,0,0,0.1); position: absolute; top: 5%; left: 50%; transform: translateX(-50%); z-index: 999;">
  <h1 style="margin-top: 0;">Nodal Point Calibration Trainer</h1>
  <h2>Nodal Zero Viewer</h2>

  <p><strong>This interactive tool teaches you how to spot and correct unwanted parallax in camera rigs.</strong></p>

  <h2>What You See</h2>
  <ul>
    <li><strong>Red & Blue Cylinders:</strong> Foreground subjects are stacked one one the other, with a visible gap.</li>
    <li><strong>Yellow Cylinder:</strong> Tall background reference, visible above, below, and through the gap.</li>
    <li><strong>All objest are the same diameter, or width.</strong></li>
  </ul>

  <h2>How It Works</h2>
  <ul>
    <li>The scene starts with the camera mounted at the body — over the tripod pivot.</li>
    <li><strong>Use the Pan slider</strong> to rotate the rig and notice how the foreground and background shift: <br />this is <strong>unwanted parallax</strong>.</li>
    <li><strong>View in the Main camera</strong> to see the parallax change</li>
    <li><strong>Adjust Z-Offset slider</strong> to find non-parallax position — this is the correct nodal alignment.</li>
    <li><strong>Switch to the Witness Camera</strong> to see the rig from the side. In VR, walk around to inspect the geometry.</li>
  </ul>

  <h2>What You're Learning</h2>
  <p>You're visually tuning your camera to behave like a CG camera — one that rotates around its 'nodal point' and introduces no parallax shift when panning.</p>
  <p>Build or buy an offset arm or slider or other camera support to mechanically calibrate the nodal point.</p>

  <h2>⚡ Tips</h2>
  <ul>
    <li><strong>Switch back</strong> to the main camera and test again: when aligned, the background stays fixed behind the gap.</li>
    <li>Click <strong>“Send to Nodal Zero”</strong> to jump to the correct offset instantly.</li>
    <li>Use sliders to experiment — and train your eye to see parallax.</li>
  </ul>

  <div style="margin-top: 2em; text-align: center;">
    <button id="launchBtn"
            style="font-size: 1.1em; padding: 0.75em 1.5em; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
      ✅ Launch Calibration Tool
    </button>
  </div>
</section>
    
    
    <a-scene reflection="directionalLight:a-light#dirlight">
      <a-assets>
        <a-asset-item id="cameraRigModel" src="camera-icon.glb"></a-asset-item>
        <a-asset-item id="cameraSupportModel" src="camera-support.glb"></a-asset-item>
        <img id="checker" src="grid_1in_20in.png" crossorigin="anonymous" />
      </a-assets>

     <a-light id="ambient" type="ambient" intensity=".15" color="#ffffff"> </a-light>
      <a-light
        type="directional"
        light="castShadow:true;"
        position="1 1 1"
        intensity=".85"
        shadow-camera-automatic="#objects"></a-light>

      <!-- Rotator: spins the entire rig horizontally -->
      <a-entity id="rotatorBase" rotation-controller="axis: y; inputId: panSlider" position="0 1.5 0">
        <a-entity gltf-model="#cameraSupportModel" position="0 0 0" scale="1 1 1" rotation="0 0 0"></a-entity>
        <!-- Linear slider: moves camera along its Z axis (in and out from pivot) -->
        <a-entity id="linearMover" z-offset-controller="inputId: zSlider; min: -2.2; max: .5" position="0 0 0">
          <!-- Camera assembly at the end of the slider -->
          <a-entity id="mainCameraRig" position="0 0 0">
            <!-- GLB camera + rig model -->
            <a-entity gltf-model="#cameraRigModel" position="0 0 0" scale="1 1 1" rotation="0 0 0"></a-entity>

            <!-- Actual camera -->
            <a-camera
              id="mainCamera"
              camera="active: true"
              look-controls-enabled="false"
              wasd-controls-enabled="false"
              position="0 0 0"
              fov="85">
              <!-- UI Controls -->
              <div class="ui-overlay" style="position: fixed; top: 60px; left: 20px; z-index: 100;">
              
                <!-- Pan Slider -->
                <label
                  for="panSlider"
                  class="ui-control"
                  style="position: absolute; top: 0px; left: 20px; z-index: 10; font-family: sans-serif">
                  Pan Rotation (Y): <span id="panValue">0</span>°
                </label>
                <input
                  class="ui-control"
                  type="range"
                  id="panSlider"
                  min="-45"
                  max="45"
                  value="0"
                  style="position: absolute; top: 20px; left: 20px; width: 300px; z-index: 10" />
                <!-- Z-Offset Slider -->
                <label
                  for="zSlider"
                  style="position: absolute; top: 60px; left: 20px; z-index: 10; font-family: sans-serif">
                  Z Offset: <span id="zValue">0</span> mm
                </label>
                <input
                  class="ui-control"
                  type="range"
                  id="zSlider"
                  min="-2200"
                  max="500"
                  step="0.01"
                  value="-2200"
                  style="position: absolute; top: 80px; left: 20px; width: 300px; z-index: 10" />

                <button
                  id="switchCameraBtn"
                  class="ui-control"
                  style="position: absolute; top: 140px; left: 20px; z-index: 10">
                  Switch to Witness Camera
                </button>
                <button id="homeBtn" class="ui-control" style="position: absolute; top: 180px; left: 20px; z-index: 10">
                  Send to Standard Position
                </button>

                <button id="zeroBtn" class="ui-control" style="position: absolute; top: 220px; left: 20px; z-index: 10">
                  Send to Nodal Zero (Calibrated)
                </button>
              </div>
            </a-camera>

            <!-- Visual AOV frame -->
            <a-entity aov-frame position="0 0 -1" scale="1.78 1 1"></a-entity>
          </a-entity>
        </a-entity>
      </a-entity>

      <!-- Witness camera -->
      <a-entity id="witnessRig" position="10 0 0" rotation="0 90 0">
        <a-camera id="witnessCamera" camera="active: false"></a-camera>
      </a-entity>

      <!-- Scene objects -->
      <a-cylinder position="0 1.75 -3.5" color="hsl(0, 71%, 33%)" radius="0.1" height=".23"></a-cylinder>
      <a-cylinder position="0 1.25 -3.5" color="hsl(240, 98%, 25%)" radius="0.1" height=".23"></a-cylinder>
      <a-cylinder position="0 1.5 -6" color="#ffff00" radius="0.1" height="3"></a-cylinder>

      <!-- Environment -->
      <a-plane
        position="0 -2 0"
        rotation="-90 90 0"
        width="35.4"
        height="20"
        material="src: #checker; repeat: 1 1; transparent: false;"></a-plane>
      <a-sky color="#c4c8ff"></a-sky>
      <!-- Footer Widget -->

      <div style="position: fixed; bottom: 10px; right: 10px; z-index: 100; font-family: sans-serif; font-size: 0.8em; color: #aaa;">
   © LIMNMEDIA 2025 <br/> <strong>Nodal Zero Viewer</strong> is an educational tool by <a href="https://limnmedia.com" target="_blank">LIMNMEDIA</a>  
  <br/>
  Visualize parallax and camera Z-offset — because seeing is understanding.
</div>
    </a-scene>
  </body>
</html>